name: PR closed

on:
  pull_request:
    types:
      - closed

jobs:
  if_merged:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
    - name: Send to discord
      run: |
          sudo apt-get install -y jq
          
          JSON_PAYLOAD=$(jq -n \
            --arg username "GitHub Bot" \
            --arg avatar_url "https://github.com/github.png" \
            --arg pr_title "${{ github.event.pull_request.title }}" \
            --arg pr_url "${{ github.event.pull_request.html_url }}" \
            --arg timestamp "$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
            '{
              username: $username,
              avatar_url: $avatar_url,
              embeds: [{
                title: "üîó Pull Request Merged",
                url: $pr_url,
                color: 10181046,
                timestamp: $timestamp,
                fields: [
                  {
                    "name": "üë§ Author", 
                    "value": $ARGS.named["author"],
                    "inline": true
                  },
                  {
                    "name": "üåø Branch",
                    "value": $ARGS.named["branch"], 
                    "inline": true
                  },
                  {
                    "name": "üìù Title",
                    "value": $pr_title
                  }
                ]
              }]
            }' \
            --arg author "${{ github.actor }}" \
            --arg branch "${{ github.event.pull_request.head.ref }} ‚Üí ${{ github.event.pull_request.base.ref }}")
          
          curl -H "Content-Type: application/json" \
          -X POST \
          -d "$JSON_PAYLOAD" \
          ${{ secrets.DISCORD_WEBHOOK_URL }}
  else:
    if: github.event.pull_request.merged == false
    runs-on: ubuntu-latest
    steps:
    - name: Send to discord
      run: |
          sudo apt-get install -y jq
          
          JSON_PAYLOAD=$(jq -n \
            --arg username "GitHub Bot" \
            --arg avatar_url "https://github.com/github.png" \
            --arg pr_title "${{ github.event.pull_request.title }}" \
            --arg pr_url "${{ github.event.pull_request.html_url }}" \
            --arg timestamp "$(date -u +%Y-%m-%dT%H:%M:%SZ)" \
            '{
              username: $username,
              avatar_url: $avatar_url,
              embeds: [{
                title: "‚ùå Pull Request Closed",
                url: $pr_url,
                color: 15158332,
                timestamp: $timestamp,
                fields: [
                  {
                    "name": "üë§ Author", 
                    "value": $ARGS.named["author"],
                    "inline": true
                  },
                  {
                    "name": "üåø Branch",
                    "value": $ARGS.named["branch"], 
                    "inline": true
                  },
                  {
                    "name": "üìù Title",
                    "value": $pr_title
                  }
                ]
              }]
            }' \
            --arg author "${{ github.actor }}" \
            --arg branch "${{ github.event.pull_request.head.ref }} ‚Üí ${{ github.event.pull_request.base.ref }}")
          
          curl -H "Content-Type: application/json" \
          -X POST \
          -d "$JSON_PAYLOAD" \
          ${{ secrets.DISCORD_WEBHOOK_URL }}
